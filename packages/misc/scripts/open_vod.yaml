---
alias: Open VOD
variables:
  media_player_entity_id: >-
    {% if is_state("binary_sensor.ground_floor_occupied", "off")
    %}
    media_player.bedroom_tv
    {% else %}
    media_player.living_room_tv
    {% endif %}
  media_player_content_id: >-
    {% if app_name is defined and app_name | length %}
      {{ app_name }}
    {% endif %}
sequence:
  - service: media_player.turn_on
    data_template:
      entity_id: "{{ media_player_entity_id }}"

  - if:
      - condition: template
        value_template: "{{ media_player_content_id | length > 0 }}"
    then:
      - action: media_player.play_media
        data:
          media_content_type: app
          media_content_id: "{{ media_player_content_id }}"
        target:
          entity_id: "{{ media_player_entity_id }}"

  - service: light.turn_on
    data:
      entity_id: light.living_room_tv_leds_with_power

  - service: media_player.volume_set
    data_template:
      entity_id: "{{ media_player_entity_id }}"
      volume_level: 0.22
