---
alias: Bedroom Sona Dial Switch
description: Sona's dial - controls bedroom light brightness via rotation, toggle/off via button
id: e60904ec-3ce6-1886-e094-0c028659abbf

triggers:
  - platform: mqtt
    topic: "zigbee2mqtt/sona_bedroom_switch"

variables:
  action: "{{ trigger.payload_json.action }}"
  brightness: "{{ trigger.payload_json.brightness | int(0) }}"

actions:
  - choose:
      # Brightness step up/down - use Z2M calculated brightness
      - conditions:
          - condition: template
            value_template: "{{ action in ['brightness_step_up', 'brightness_step_down'] }}"
        sequence:
          - action: light.turn_on
            target:
              entity_id: light.bedroom_sona_with_power
            data:
              brightness: "{{ brightness }}"
              transition: 0.3

      # Button short press - toggle
      - conditions:
          - condition: template
            value_template: "{{ action == 'button_1_press_release' }}"
        sequence:
          - action: light.toggle
            target:
              entity_id: light.bedroom_sona_bulbs

      # Button short press - toggle
      - conditions:
          - condition: template
            value_template: "{{ action == 'button_2_press_release' }}"
        sequence:
          - action: light.toggle
            target:
              entity_id: light.bedroom_reflectors_with_power

      - conditions:
          - condition: template
            value_template: "{{ action == 'button_3_press_release' }}"
        sequence:
          - action: cover.toggle
            target:
              entity_id: cover.bedroom

mode: restart
